<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ì´ë¦„ì„ í˜¸ëª…í•˜ì‹œì˜¤</title>
<style>
@font-face{
  font-family:"OnulDanjo";
  src:url("./OnulDanjo-Regular.otf") format("opentype");
  font-display:swap;
}
@font-face{
  font-family:"WingdingsCustom";
  src:url("./Wingdings.ttf") format("truetype");
  font-display:swap;
}

html,body{
  height:100%; margin:0; background:#000; overflow:hidden;
  font-family:"OnulDanjo", Arial, sans-serif; color:#000;
}

/* ==== ë°°ê²½ ==== */
.bg-rings{
  position:fixed; inset:0; display:flex; justify-content:center; align-items:center;
  z-index:0; pointer-events:none;
}
.bg-rings svg{ width:100vmin; height:100vmin; overflow:visible; }
.ring{ transform-box:fill-box; transform-origin:50% 50%; }
@keyframes spinZoom-cw{0%{transform:rotate(0) scale(1)}50%{transform:rotate(180deg) scale(1.5)}100%{transform:rotate(360deg) scale(1)}}
@keyframes spinZoom-ccw{0%{transform:rotate(0) scale(1)}50%{transform:rotate(-180deg) scale(1.5)}100%{transform:rotate(-360deg) scale(1)}}
.r1{animation:spinZoom-cw 12s ease-in-out infinite;}
.r2{animation:spinZoom-ccw 10s ease-in-out infinite;}
.r3{animation:spinZoom-cw 8s ease-in-out infinite;}
.r4{animation:spinZoom-ccw 6s ease-in-out infinite;}

/* ==== ì‹œíŠ¸ ==== */
.sheet-wrap{
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  z-index:2; overflow:auto; max-height:85vh; border:1px solid #000; background:transparent;
}
.sheet-wrap::-webkit-scrollbar{width:6px;height:6px}
.sheet-wrap::-webkit-scrollbar-thumb{background:rgba(255,255,255,.25);border-radius:4px;}
.sheet-wrap::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.5)}
.sheet-wrap::-webkit-scrollbar-track{background:transparent}

table.sheet{
  border-collapse:collapse; border:1px solid #000; table-layout:fixed; font-size:13px;
  font-family:"OnulDanjo","Noto Sans KR",sans-serif; color:#000;
}
.sheet th,.sheet td{
  border:1px solid #000; height:28px; text-align:center; vertical-align:middle;
  transition:background .25s ease; font-weight:400;
}
.sheet th:first-child,.sheet td:first-child{
  width:140px; text-align:left; padding-left:8px; font-weight:500;
}
.sheet th:not(:first-child),.sheet td:not(:first-child){ width:38px; }

/* ==== ììŒ/ëª¨ìŒ ==== */
.icon{
  display:inline-flex; justify-content:center; align-items:center;
  width:22px; height:22px; border:1.4px dotted #000; border-radius:50%;
  font-family:"WingdingsCustom"; font-size:18px; opacity:0; transform:scale(.5);
  transition:all .4s ease;
}
.icon.show{opacity:1; transform:scale(1);}
.vowel{
  display:inline-block; background:#000; border-radius:50%;
  width:12px; height:12px; opacity:0; transition:opacity .25s ease;
}
.vowel.show{opacity:1;}

/* ==== ì»¨íŠ¸ë¡¤ ==== */
.print-bar{position:fixed; left:12px; bottom:12px; z-index:3; display:flex; gap:8px;}
.btn{cursor:pointer; background:#fff; color:#000; border-radius:8px; padding:6px 10px; border:none; font-size:12px;}
.hint{position:fixed; left:12px; bottom:48px; font-size:12px; color:#ccc; z-index:3}

/* ==== ì„¤ëª… ë²„íŠ¼ ==== */
.info-btn{
  position:fixed; right:16px; bottom:16px; z-index:5;
  background:#fff; color:#000; border:none; border-radius:20px; padding:6px 12px; font-size:13px;
  cursor:pointer; opacity:.8; transition:opacity .2s ease;
}
.info-btn:hover{opacity:1}
.info-modal{
  position:fixed; inset:0; background:rgba(0,0,0,.55);
  display:none; justify-content:center; align-items:center; z-index:10;
}
.info-content{
  position:relative; background:#fff; color:#111;
  max-width:260px; padding:24px 28px; border-radius:16px; box-shadow:0 8px 20px rgba(0,0,0,.25);
  font-family:"OnulDanjo","Noto Sans KR",sans-serif; line-height:1.6; animation:fadeIn .4s ease;
}
.info-content p{font-size:13.5px; margin:0 0 6px 0;}
.info-content .close{position:absolute; right:22px; top:18px; font-size:20px; cursor:pointer; color:#333}
@keyframes fadeIn{from{opacity:0; transform:translateY(10px)}to{opacity:1; transform:none}}

@media print{
  @page{ size:A4 portrait; margin:10mm }
  *{-webkit-print-color-adjust:exact; print-color-adjust:exact}
  .bg-rings,.print-bar,.hint,.info-btn,.info-modal{ display:none !important }
  html,body{ background:#fff !important; color:#000 !important; overflow:visible !important; height:auto }
}
</style>
</head>
<body>

<!-- ==== ë°°ê²½ ==== -->
<div class="bg-rings">
  <svg viewBox="0 0 1000 1000">
    <circle class="ring r1" cx="500" cy="500" r="500" fill="none" stroke="#fff" stroke-width="260"/>
    <circle class="ring r2" cx="500" cy="500" r="370" fill="none" stroke="#e6e6e6" stroke-width="240"/>
    <circle class="ring r3" cx="500" cy="500" r="250" fill="none" stroke="#999" stroke-width="220"/>
    <circle class="ring r4" cx="500" cy="500" r="130" fill="none" stroke="#444" stroke-width="200"/>
    <circle cx="500" cy="500" r="70" fill="#000"/>
  </svg>
</div>

<!-- ==== ì‹œíŠ¸ ==== -->
<div class="sheet-wrap" id="sheetWrap">
  <table class="sheet" id="sheet">
    <thead><tr><th>NAME</th></tr></thead>
    <tbody id="sheetBody"></tbody>
  </table>
</div>

<div class="hint" id="hint">ğŸ§ í™œì„±í™”</div>
<div class="print-bar">
  <button id="startBtn" class="btn">ğŸ™</button>
  <button id="printBtn" class="btn">ğŸ“„PDF</button>
</div>

<!-- ==== ì„¤ëª… ë²„íŠ¼ & íŒì—… ==== -->
<button id="infoBtn" class="info-btn">â„¹ï¸ ì„¤ëª…</button>
<div id="infoModal" class="info-modal">
  <div class="info-content">
    <span class="close">&times;</span>
    <p>ì´ë¦„ë“¤ì˜ ìƒê¹€ìƒˆëŠ” ì™„ë²½íˆ ë™ë“±í•œ ê²ƒì´ ì—†ëŠ”ë° ì–´ë”˜ê°€ ê°€ë§Œíˆ ë°”ë¼ë³´ê³  ìˆìœ¼ë©´ ëª¨ë‘ í•˜ë‚˜ë¡œ ëŠê»´ì§„ë‹¤.</p>
    <p>â‘´ ì´ë¦„ì€ ì„œë¡œ ìƒìƒë˜ì–´ì•¼ í•œë‹¤.<br>â‘µ ì´ë¦„ì˜ ì²«Â·ì¤‘Â·ë ê¸€ìëŠ” ì—°ê²°ë¼ ìˆë‹¤.<br>â‘¶ ì†Œë¦¬ëŠ” ì£¼ë³€ì— ì˜í–¥ì„ ì¤€ë‹¤.</p>
    <p>ì†Œë¦¬ ë‚´ì–´ ê³µê¸°ë¥¼ ì§„ë™ì‹œì¼œì•¼ë§Œ íš¨ê³¼ê°€ ë‚˜íƒ€ë‚œë‹¤. ì´ë¦„ì´ ë‹¨ìˆœí•œ í‘œì‹ì´ ì•„ë‹ˆë¼, ë°œí™”ë˜ëŠ” ìˆœê°„ì— ìƒëª…ë ¥ì„ ì–»ëŠ” ì–¸ì–´ì  ì¡´ì¬ì„ì„ ì‹œì‚¬í•œë‹¤.</p>
    <p>í˜¸ëª…ì„ í†µí•´ í˜¸ì¶œëœ ì´ë¦„ë“¤ì€ ì‹œíŠ¸ ìœ„ì— ê¸°ë¡ë˜ê³ , ê·¸ ì†Œë¦¬ì™€ ë¦¬ë“¬ì€ ìš¸ë¦¼ì´ ëœë‹¤.</p>
    <p>ì´ë¦„ì„ í˜¸ëª…í•˜ì‹œì˜¤.</p>
  </div>
</div>

<script>
/* ==== ì„¤ëª… íŒì—… ==== */
const infoBtn=document.getElementById('infoBtn');
const infoModal=document.getElementById('infoModal');
const close=document.querySelector('.info-content .close');
infoBtn.onclick=()=>infoModal.style.display='flex';
close.onclick=()=>infoModal.style.display='none';
infoModal.onclick=e=>{ if(e.target===infoModal) infoModal.style.display='none'; };

/* ==== ì‹œíŠ¸ ì„¤ì • ==== */
const MAX_NAME_LEN=6, MAX_PARTS_PER_SYLL=3, MAX_COLS=MAX_NAME_LEN*MAX_PARTS_PER_SYLL;
const MAP={"ã„±":"1","ã„´":"2","ã„·":"9","ã„¹":"0","ã…":"9","ã…‚":"0","ã……":"7","ã…‡":"8","ã…ˆ":"5","ã…Š":"6","ã…‹":"4","ã…Œ":"3","ã…":"5","ã…":"6"};
const RING_COLORS=["#f5f5f5","#cccccc","#888888","#000000"];
const sheet=document.getElementById('sheet');
const sheetBody=document.getElementById('sheetBody');
const hint=document.getElementById('hint');

function initSheetColumns(n){
  const header=sheet.querySelector('thead tr');
  for(let i=1;i<=n;i++){ const th=document.createElement('th'); th.textContent=i; header.appendChild(th); }
}
initSheetColumns(MAX_COLS);

/* ==== í•œê¸€ ë¶„í•´ ==== */
function decomposeHangul(ch){
  const base=0xAC00;
  const chos="ã„±ã„²ã„´ã„·ã„¸ã„¹ã…ã…‚ã…ƒã……ã…†ã…‡ã…ˆã…‰ã…Šã…‹ã…Œã…ã…";
  const jungs="ã…ã…ã…‘ã…’ã…“ã…”ã…•ã…–ã…—ã…˜ã…™ã…šã…›ã…œã…ã…ã…Ÿã… ã…¡ã…¢ã…£";
  const jongs=["","ã„±","ã„²","ã„³","ã„´","ã„µ","ã„¶","ã„·","ã„¹","ã„º","ã„»","ã„¼","ã„½","ã„¾","ã„¿","ã…€","ã…","ã…‚","ã…„","ã……","ã…†","ã…‡","ã…ˆ","ã…Š","ã…‹","ã…Œ","ã…","ã…"];
  const code=ch.charCodeAt(0)-base;
  if(code<0||code>11171) return [ch];
  const cho=Math.floor(code/588), jung=Math.floor((code%588)/28), jong=code%28;
  const arr=[chos[cho], jungs[jung]]; if(jongs[jong]) arr.push(jongs[jong]); return arr;
}
function createVowelShape(){ const div=document.createElement('div'); div.className='vowel'; return div; }

/* ==== í–‰ ì¶”ê°€ ==== */
async function addRow(name){
  const chars=[...name]; const parts=[]; chars.forEach(ch=>parts.push(...decomposeHangul(ch)));
  const tr=document.createElement('tr'); const tdName=document.createElement('td'); tdName.textContent=name; tr.appendChild(tdName);
  for(let i=0;i<MAX_COLS;i++) tr.appendChild(document.createElement('td')); sheetBody.appendChild(tr);

  tdName.addEventListener('mouseenter',()=>{const c=RING_COLORS[Math.floor(Math.random()*RING_COLORS.length)];
    tdName.style.background=c; tdName.style.color=(c==="#000000"?"#fff":"#000");});
  tdName.addEventListener('mouseleave',()=>{tdName.style.background="transparent"; tdName.style.color="#000";});
  tdName.addEventListener('click',()=>waveRow(tr,80,true));

  const tds=[...tr.querySelectorAll('td')].slice(1);
  for(let i=0;i<parts.length && i<tds.length;i++){
    const td=tds[i];
    setTimeout(()=>{
      const c=RING_COLORS[Math.floor(Math.random()*RING_COLORS.length)];
      td.style.background=c;
      if(MAP[parts[i]]){const d=document.createElement('div'); d.className='icon'; d.textContent=MAP[parts[i]]; td.appendChild(d); setTimeout(()=>d.classList.add('show'),50);}
      else if(/[ã…-ã…£]/.test(parts[i])){const v=createVowelShape(); td.appendChild(v); setTimeout(()=>v.classList.add('show'),50);}
      setTimeout(()=>td.style.background='transparent',600);
    }, i*180);
  }
  tr.scrollIntoView({behavior:'smooth',block:'end'});
}

/* ==== íŒŒë„ ==== */
function waveRow(tr,step=100){const cells=[...tr.querySelectorAll('td')].slice(1);
  const color=RING_COLORS[Math.floor(Math.random()*RING_COLORS.length)];
  for(let i=0;i<cells.length;i++){setTimeout(()=>{cells[i].style.background=color;setTimeout(()=>cells[i].style.background='transparent',200);},i*step);}}

/* ==== ìŒì„± + ë§ˆì´í¬ ==== */
const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
let recog,audioCtx,analyser,timeData,micStream; let noiseFloor=0.02,lastTrigger=0;
function rms(buf){let s=0;for(let i=0;i<buf.length;i++){const v=(buf[i]-128)/128;s+=v*v;}return Math.sqrt(s/buf.length);}
async function setupMic(){micStream=await navigator.mediaDevices.getUserMedia({audio:true});
  audioCtx=new(window.AudioContext||window.webkitAudioContext)();const src=audioCtx.createMediaStreamSource(micStream);
  analyser=new AnalyserNode(audioCtx,{fftSize:1024,smoothingTimeConstant:.85});src.connect(analyser);timeData=new Uint8Array(analyser.fftSize);
  const samples=[],st=performance.now();hint.style.display='block';hint.textContent='ğŸ§ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ì¤‘...';
  (function c(){analyser.getByteTimeDomainData(timeData);samples.push(rms(timeData));
    if(performance.now()-st<1500)requestAnimationFrame(c);else{samples.sort((a,b)=>a-b);const mid=samples[Math.floor(samples.length*.5)]||0.02;
      noiseFloor=Math.max(.015,Math.min(.08,mid));hint.textContent='âœ… ìŒì„± ë°˜ì‘ í™œì„±í™”ë¨';setTimeout(()=>hint.style.display='none',1200);animateSound();}})();}
function animateSound(){analyser.getByteTimeDomainData(timeData);const r=rms(timeData),now=performance.now(),th=noiseFloor+.035;
  if(r>th&&now-lastTrigger>140){lastTrigger=now;waveRow(document.querySelector('tr:last-child')||sheetBody,80);}
  requestAnimationFrame(animateSound);}
function startSR(){if(!SR)return;recog=new SR();recog.lang='ko-KR';recog.continuous=true;recog.interimResults=true;
  recog.onresult=e=>{for(let i=e.resultIndex;i<e.results.length;i++){const res=e.results[i];if(!res.isFinal)continue;
    const raw=res[0].transcript.trim(),txt=raw.replace(/\s+/g,''),rx=/([ê°€-í£]{1,6})(?:ì´|ê°€|ë¥¼|ì„|ì€|ëŠ”)?(ì•„|ì•¼)/g;let m;while((m=rx.exec(txt))!==null){addRow(m[1]);}}};
  recog.onend=()=>{try{recog.start();}catch(_){}};recog.start();}

/* ==== ë²„íŠ¼ ==== */
document.getElementById('startBtn').addEventListener('click',async()=>{try{await setupMic();startSR();}catch(e){alert('ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.');}});
document.getElementById('printBtn').addEventListener('click',()=>window.print());
</script>
</body>
</html>
